<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåê Netlify Firebase Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .container {
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #fff;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 10px;
            background: rgba(255,255,255,0.05);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .success {
            background: rgba(76, 175, 80, 0.3);
            color: #4CAF50;
        }
        .error {
            background: rgba(244, 67, 54, 0.3);
            color: #f44336;
        }
        .warning {
            background: rgba(255, 193, 7, 0.3);
            color: #FF9800;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        .info {
            background: rgba(33, 150, 243, 0.3);
            color: #2196F3;
        }
        #console-output {
            background: #1a1a1a;
            color: #00ff00;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåê Netlify Firebase Test Sayfasƒ±</h1>
        
        <div class="test-section">
            <h3>üîß Ortam Bilgileri</h3>
            <div id="environment-info"></div>
        </div>
        
        <div class="test-section">
            <h3>üì¶ SDK Y√ºkleme Durumu</h3>
            <div id="sdk-status"></div>
        </div>
        
        <div class="test-section">
            <h3>üîë Firebase Konfig√ºrasyon</h3>
            <div id="config-status"></div>
        </div>
        
        <div class="test-section">
            <h3>üöÄ Firebase Ba≈ülatma</h3>
            <div id="firebase-init-status"></div>
            <button id="init-firebase">Firebase'i Ba≈ülat</button>
        </div>
        
        <div class="test-section">
            <h3>ü•∏ Misafir Giri≈ü Testi</h3>
            <div id="auth-status"></div>
            <button id="test-anonymous-login">Misafir Giri≈üi Test Et</button>
            <button id="logout-btn" style="background: #f44336;" disabled>√áƒ±kƒ±≈ü Yap</button>
        </div>
        
        <div class="test-section">
            <h3>üì° API Endpoint Testi</h3>
            <div id="api-status"></div>
            <button id="test-config-api">Config API Test</button>
            <button id="test-health-api">Health API Test</button>
        </div>
        
        <div class="test-section">
            <h3>üìä Console Output</h3>
            <div id="console-output"></div>
            <button id="clear-console">Console Temizle</button>
        </div>
        
        <div class="test-section">
            <h3>üîó Y√∂nlendirmeler</h3>
            <button onclick="window.location.href='login.html'">Login Sayfasƒ±na Git</button>
            <button onclick="window.location.href='index.html'">Ana Sayfaya Git</button>
        </div>
    </div>

    <!-- Firebase SDK'larƒ± -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>

    <!-- Konfig√ºrasyon dosyalarƒ± -->
    <script src="env-config.js"></script>
    <script src="netlify-config.js"></script>
    <script src="netlify-firebase-init.js"></script>

    <script>
        // Console'ƒ± yakalama
        const consoleOutput = document.getElementById('console-output');
        const originalLog = console.log;
        const originalError = console.error;
        const originalInfo = console.info;
        const originalWarn = console.warn;

        function addToConsole(type, message, data = '') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message} ${data ? JSON.stringify(data, null, 2) : ''}\n`;
            consoleOutput.textContent += logEntry;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        console.log = function(message, data) {
            addToConsole('log', message, data);
            originalLog.apply(console, arguments);
        };

        console.error = function(message, data) {
            addToConsole('error', message, data);
            originalError.apply(console, arguments);
        };

        console.info = function(message, data) {
            addToConsole('info', message, data);
            originalInfo.apply(console, arguments);
        };

        console.warn = function(message, data) {
            addToConsole('warn', message, data);
            originalWarn.apply(console, arguments);
        };

        // Test fonksiyonlarƒ±
        function updateStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="test-result ${type}">${message}</div>`;
        }

        function checkEnvironment() {
            const info = {
                hostname: window.location.hostname,
                isNetlify: window.location.hostname.includes('netlify.app') || window.location.hostname.includes('netlify.com'),
                userAgent: navigator.userAgent,
                protocol: window.location.protocol
            };
            
            updateStatus('environment-info', `
                üåê Hostname: ${info.hostname}<br>
                üì± Netlify: ${info.isNetlify ? 'EVET' : 'HAYIR'}<br>
                üîí Protocol: ${info.protocol}<br>
                üñ•Ô∏è Browser: ${info.userAgent.substring(0, 50)}...
            `);
        }

        function checkSDKs() {
            const sdks = {
                firebase: typeof firebase !== 'undefined',
                firebaseAuth: typeof firebase !== 'undefined' && firebase.auth,
                firebaseDatabase: typeof firebase !== 'undefined' && firebase.database,
                firebaseFirestore: typeof firebase !== 'undefined' && firebase.firestore
            };

            let html = '';
            Object.entries(sdks).forEach(([name, loaded]) => {
                html += `${name}: ${loaded ? '‚úÖ Y√ºklendi' : '‚ùå Y√ºklenmedi'}<br>`;
            });

            updateStatus('sdk-status', html, sdks.firebase ? 'success' : 'error');
        }

        function checkConfig() {
            const config = {
                apiKey: window.FIREBASE_API_KEY,
                authDomain: window.FIREBASE_AUTH_DOMAIN,
                projectId: window.FIREBASE_PROJECT_ID
            };

            let html = '';
            Object.entries(config).forEach(([name, value]) => {
                html += `${name}: ${value ? '‚úÖ Var' : '‚ùå Yok'}<br>`;
            });

            updateStatus('config-status', html, config.apiKey ? 'success' : 'warning');
        }

        function initFirebase() {
            if (window.NetlifyFirebase) {
                window.NetlifyFirebase.init()
                    .then(() => {
                        updateStatus('firebase-init-status', '‚úÖ Firebase ba≈üarƒ±yla ba≈ülatƒ±ldƒ±!', 'success');
                        document.getElementById('test-anonymous-login').disabled = false;
                    })
                    .catch(error => {
                        updateStatus('firebase-init-status', `‚ùå Firebase ba≈ülatma hatasƒ±: ${error.message}`, 'error');
                    });
            } else {
                updateStatus('firebase-init-status', '‚ùå NetlifyFirebase bulunamadƒ±', 'error');
            }
        }

        function testAnonymousLogin() {
            if (window.netlifyAnonymousLogin) {
                updateStatus('auth-status', 'üîÑ Misafir giri≈üi deneniyour...', 'warning');
                
                window.netlifyAnonymousLogin()
                    .then(user => {
                        updateStatus('auth-status', `‚úÖ Misafir giri≈üi ba≈üarƒ±lƒ±! User ID: ${user.uid}`, 'success');
                        document.getElementById('logout-btn').disabled = false;
                    })
                    .catch(error => {
                        updateStatus('auth-status', `‚ùå Misafir giri≈üi ba≈üarƒ±sƒ±z: ${error.message}`, 'error');
                    });
            } else {
                updateStatus('auth-status', '‚ùå netlifyAnonymousLogin fonksiyonu bulunamadƒ±', 'error');
            }
        }

        function logout() {
            const auth = window.NetlifyFirebase?.getAuth();
            if (auth) {
                auth.signOut()
                    .then(() => {
                        updateStatus('auth-status', '‚úÖ √áƒ±kƒ±≈ü yapƒ±ldƒ±', 'success');
                        document.getElementById('logout-btn').disabled = true;
                    })
                    .catch(error => {
                        updateStatus('auth-status', `‚ùå √áƒ±kƒ±≈ü hatasƒ±: ${error.message}`, 'error');
                    });
            }
        }

        function testConfigAPI() {
            fetch('/api/config')
                .then(response => response.json())
                .then(data => {
                    updateStatus('api-status', `‚úÖ Config API √ßalƒ±≈üƒ±yor: ${JSON.stringify(data, null, 2)}`, 'success');
                })
                .catch(error => {
                    updateStatus('api-status', `‚ùå Config API hatasƒ±: ${error.message}`, 'error');
                });
        }

        function testHealthAPI() {
            fetch('/api/health')
                .then(response => response.json())
                .then(data => {
                    updateStatus('api-status', `‚úÖ Health API √ßalƒ±≈üƒ±yor: ${JSON.stringify(data, null, 2)}`, 'success');
                })
                .catch(error => {
                    updateStatus('api-status', `‚ùå Health API hatasƒ±: ${error.message}`, 'error');
                });
        }

        function clearConsole() {
            consoleOutput.textContent = '';
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            checkEnvironment();
            checkSDKs();
            checkConfig();
            
            document.getElementById('init-firebase').addEventListener('click', initFirebase);
            document.getElementById('test-anonymous-login').addEventListener('click', testAnonymousLogin);
            document.getElementById('logout-btn').addEventListener('click', logout);
            document.getElementById('test-config-api').addEventListener('click', testConfigAPI);
            document.getElementById('test-health-api').addEventListener('click', testHealthAPI);
            document.getElementById('clear-console').addEventListener('click', clearConsole);
            
            console.info('üß™ Test sayfasƒ± y√ºklendi');
        });
    </script>
</body>
</html> 