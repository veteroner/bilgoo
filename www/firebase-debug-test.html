<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Test ve Hesap Silme Debug</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px;
            background: #f5f5f5;
        }
        .debug-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .debug-section {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        .error-section {
            background: #fef2f2;
            border-left-color: #dc2626;
            color: #dc2626;
        }
        .success-section {
            background: #f0fdf4;
            border-left-color: #10b981;
            color: #065f46;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .delete-button {
            background: #dc2626;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        .delete-button:hover {
            background: #b91c1c;
        }
        pre {
            background: #1f2937;
            color: #f3f4f6;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: white;
            padding: 0;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
        }
        .modal-header {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: white;
            padding: 20px;
            border-radius: 20px 20px 0 0;
            position: relative;
        }
        .close {
            position: absolute;
            top: 15px;
            right: 20px;
            color: white;
            font-size: 28px;
            cursor: pointer;
        }
        .modal-body {
            padding: 30px;
        }
        .modal-footer {
            padding: 20px;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            border-radius: 0 0 20px 20px;
            background: #f9fafb;
        }
        .btn-secondary {
            background: #6b7280;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn-danger {
            background: #dc2626;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn-danger:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>ğŸ”§ Firebase Test ve Hesap Silme Debug</h1>
        
        <div class="debug-section">
            <h3>1. Firebase BaÄŸlantÄ± Testi</h3>
            <button class="test-button" onclick="testFirebaseConnection()">Firebase BaÄŸlantÄ±sÄ±nÄ± Test Et</button>
            <div id="firebase-status">â³ Test bekleniyor...</div>
        </div>

        <div class="debug-section">
            <h3>2. DOM Element KontrolÃ¼</h3>
            <button class="test-button" onclick="checkDOMElements()">DOM Elementlerini Kontrol Et</button>
            <div id="dom-status">â³ Test bekleniyor...</div>
        </div>

        <div class="debug-section">
            <h3>3. Hesap Silme Modal Testi</h3>
            <button class="delete-button" id="test-delete-button">
                ğŸ—‘ï¸ HesabÄ±mÄ± Sil (Test)
            </button>
            <div id="modal-test-status">â³ Test bekleniyor...</div>
        </div>

        <div class="debug-section">
            <h3>4. Console Log'larÄ±</h3>
            <button class="test-button" onclick="showConsoleLogs()">Console Log'larÄ± GÃ¶ster</button>
            <pre id="console-logs">Console log'larÄ± burada gÃ¶rÃ¼necek...</pre>
        </div>

        <div class="debug-section">
            <h3>5. Firebase Auth Test</h3>
            <button class="test-button" onclick="testFirebaseAuth()">Firebase Auth Durumunu Kontrol Et</button>
            <div id="auth-status">â³ Test bekleniyor...</div>
        </div>

        <div class="debug-section">
            <h3>6. GerÃ§ek Hesap Silme Testi</h3>
            <button class="delete-button" id="real-delete-account-button">
                ğŸ—‘ï¸ HesabÄ±mÄ± Sil (GerÃ§ek Test)
            </button>
            <div id="real-deletion-status">â³ Test bekleniyor...</div>
        </div>
    </div>

    <!-- Real Account Deletion Modal -->
    <div id="real-account-deletion-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>âš ï¸ Hesap Silme OnayÄ±</h3>
                <button class="close" id="close-real-deletion-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div style="background: #fee2e2; border: 2px solid #fca5a5; padding: 20px; border-radius: 12px; margin-bottom: 25px;">
                    <div style="display: flex; align-items: center; margin-bottom: 15px;">
                        <span style="font-size: 2em; margin-right: 15px;">âš ï¸</span>
                        <h4 style="color: #dc2626; margin: 0; font-size: 1.3em;">DÄ°KKAT: Bu iÅŸlem geri alÄ±namaz!</h4>
                    </div>
                    <p style="color: #7f1d1d; margin: 0; font-weight: 500;">
                        HesabÄ±nÄ±zÄ± sildiÄŸinizde, tÃ¼m verileriniz kalÄ±cÄ± olarak silinecek ve bu iÅŸlem geri alÄ±namayacaktÄ±r.
                    </p>
                </div>

                <div style="background: #f0f9ff; border: 1px solid #bae6fd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <h4 style="color: #0369a1; margin: 0 0 10px 0; display: flex; align-items: center;">
                        <span style="margin-right: 8px;">ğŸ—‘ï¸</span> Silinecek Veriler:
                    </h4>
                    <ul style="color: #0c4a6e; margin: 0; padding-left: 20px;">
                        <li>Profil bilgileriniz</li>
                        <li>Oyun skorlarÄ±nÄ±z</li>
                        <li>Ä°statistikleriniz</li>
                        <li>ArkadaÅŸ listesi</li>
                        <li>BaÅŸarÄ±larÄ±nÄ±z</li>
                        <li>TÃ¼m oyun geÃ§miÅŸi</li>
                    </ul>
                </div>

                <div style="background: #f9fafb; border: 1px solid #d1d5db; padding: 15px; border-radius: 8px; margin-bottom: 25px;">
                    <h4 style="color: #374151; margin: 0 0 15px 0;">âœ‰ï¸ Hesap Silme SeÃ§enekleri:</h4>
                    
                    <div style="margin-bottom: 15px;">
                        <button id="real-delete-account-now" class="btn-danger" style="width: 100%; padding: 12px; font-size: 14px;" disabled>
                            <span style="margin-right: 8px;">âš¡</span> HesabÄ±mÄ± Åimdi Sil
                        </button>
                        <p style="margin: 8px 0 0 0; font-size: 12px; color: #6b7280;">HesabÄ±nÄ±z anÄ±nda silinir.</p>
                    </div>
                    
                    <div>
                        <button id="real-email-deletion-request" class="btn-secondary" style="width: 100%; padding: 12px; font-size: 14px;">
                            <span style="margin-right: 8px;">ğŸ“§</span> E-posta ile Silme Talebi GÃ¶nder
                        </button>
                        <p style="margin: 8px 0 0 0; font-size: 12px; color: #6b7280;">48 saat iÃ§inde manuel olarak silinir.</p>
                    </div>
                </div>

                <label style="display: flex; align-items: center; margin: 20px 0; padding: 15px; background: #fef3c7; border: 1px solid #fbbf24; border-radius: 8px;">
                    <input type="checkbox" id="real-deletion-confirmation" style="margin-right: 12px; transform: scale(1.2);">
                    <span style="color: #92400e; font-weight: 500;">
                        Hesap silme iÅŸlemini anladÄ±m ve onaylÄ±yorum. Bu iÅŸlemin geri alÄ±namayacaÄŸÄ±nÄ± kabul ediyorum.
                    </span>
                </label>
            </div>
            <div class="modal-footer">
                <button id="real-cancel-deletion" class="btn-secondary">Ä°ptal</button>
                <button id="real-confirm-deletion" class="btn-danger" disabled>Onayla ve Devam Et</button>
            </div>
        </div>
    </div>

    <!-- Test Modal -->
    <div id="test-deletion-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>âš ï¸ Hesap Silme OnayÄ± (TEST)</h3>
                <button class="close" id="close-test-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div style="background: #fee2e2; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <h4 style="color: #991b1b; margin: 0 0 10px 0;">ğŸ§ª TEST MODU AKTIF</h4>
                    <p style="color: #7f1d1d; margin: 0;">Bu test modalÄ±dÄ±r. GerÃ§ek hesap silme iÅŸlemi yapmaz.</p>
                </div>
                
                <p><strong>âœ… Modal baÅŸarÄ±yla aÃ§Ä±ldÄ±!</strong></p>
                <p>Bu test, hesap silme modalÄ±nÄ±n doÄŸru Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± gÃ¶sterir.</p>
                
                <label style="display: flex; align-items: center; margin: 15px 0;">
                    <input type="checkbox" id="test-confirmation" style="margin-right: 10px;">
                    <span>Test onayÄ±nÄ± kabul ediyorum.</span>
                </label>
            </div>
            <div class="modal-footer">
                <button id="cancel-test" class="btn-secondary">Ä°ptal</button>
                <button id="confirm-test" class="btn-danger" disabled>Test Onayla</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyAbI5Swc136jjPCKeH1erjoDuhG2GUPnn0",
            authDomain: "bilgisel-3e9a0.firebaseapp.com",
            databaseURL: "https://bilgisel-3e9a0-default-rtdb.firebaseio.com",
            projectId: "bilgisel-3e9a0",
            storageBucket: "bilgisel-3e9a0.appspot.com",
            messagingSenderId: "921907280109",
            appId: "1:921907280109:web:7d9b4844067a7a1ac174e4",
            measurementId: "G-XH10LS7DW8"
        };

        // Console log capture
        let consoleLogs = [];
        const originalConsole = {
            log: console.log,
            error: console.error,
            warn: console.warn
        };

        console.log = function(...args) {
            consoleLogs.push({type: 'log', args: args, time: new Date().toLocaleTimeString()});
            originalConsole.log.apply(console, args);
        };

        console.error = function(...args) {
            consoleLogs.push({type: 'error', args: args, time: new Date().toLocaleTimeString()});
            originalConsole.error.apply(console, args);
        };

        console.warn = function(...args) {
            consoleLogs.push({type: 'warn', args: args, time: new Date().toLocaleTimeString()});
            originalConsole.warn.apply(console, args);
        };

        // Firebase Test Functions
        function testFirebaseConnection() {
            const statusDiv = document.getElementById('firebase-status');
            statusDiv.innerHTML = 'â³ Firebase baÄŸlantÄ±sÄ± test ediliyor...';

            try {
                // Initialize Firebase
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }

                const auth = firebase.auth();
                const firestore = firebase.firestore();
                const database = firebase.database();

                statusDiv.innerHTML = `
                    <div class="success-section">
                        âœ… Firebase baÅŸarÄ±yla baÄŸlandÄ±!<br>
                        ğŸ” Auth: ${auth ? 'Mevcut' : 'Hata'}<br>
                        ğŸ“Š Firestore: ${firestore ? 'Mevcut' : 'Hata'}<br>
                        ğŸ—„ï¸ Database: ${database ? 'Mevcut' : 'Hata'}
                    </div>
                `;
            } catch (error) {
                statusDiv.innerHTML = `
                    <div class="error-section">
                        âŒ Firebase baÄŸlantÄ± hatasÄ±:<br>
                        ${error.message}
                    </div>
                `;
            }
        }

        function checkDOMElements() {
            const statusDiv = document.getElementById('dom-status');
            const requiredElements = [
                'test-delete-button',
                'test-deletion-modal',
                'close-test-modal',
                'cancel-test',
                'confirm-test',
                'test-confirmation'
            ];

            let html = '<h4>DOM Element Kontrol SonuÃ§larÄ±:</h4><ul>';
            let allFound = true;

            requiredElements.forEach(id => {
                const element = document.getElementById(id);
                const exists = element !== null;
                if (!exists) allFound = false;
                const color = exists ? 'green' : 'red';
                const icon = exists ? 'âœ…' : 'âŒ';
                html += `<li style="color: ${color};">${icon} ${id}: ${exists ? 'Mevcut' : 'BulunamadÄ±'}</li>`;
            });

            html += '</ul>';

            if (allFound) {
                html = `<div class="success-section">${html}</div>`;
            } else {
                html = `<div class="error-section">${html}</div>`;
            }

            statusDiv.innerHTML = html;
        }

        function testFirebaseAuth() {
            const statusDiv = document.getElementById('auth-status');
            statusDiv.innerHTML = 'â³ Firebase Auth test ediliyor...';

            try {
                const auth = firebase.auth();
                
                // Test iÃ§in sahte bir kullanÄ±cÄ± oluÅŸturalÄ±m
                statusDiv.innerHTML = `
                    <div class="success-section">
                        âœ… Test kullanÄ±cÄ±sÄ± oluÅŸturuluyor...<br>
                        ğŸ“§ Email: test@bilgoo.com<br>
                        ğŸ†” UID: test-user-123<br>
                        ğŸ“… Test modu aktif
                    </div>
                `;
                
                // Test kullanÄ±cÄ±sÄ±nÄ± simÃ¼le et
                window.mockUser = {
                    email: 'test@bilgoo.com',
                    uid: 'test-user-123',
                    metadata: {
                        creationTime: new Date().toISOString()
                    }
                };
                
                // Firebase auth state'ini override et
                if (auth) {
                    Object.defineProperty(auth, 'currentUser', {
                        get: function() {
                            return window.mockUser;
                        }
                    });
                }
                
            } catch (error) {
                statusDiv.innerHTML = `
                    <div class="error-section">
                        âŒ Firebase Auth hatasÄ±:<br>
                        ${error.message}
                    </div>
                `;
            }
        }

        function showConsoleLogs() {
            const logsDiv = document.getElementById('console-logs');
            let html = '';

            if (consoleLogs.length === 0) {
                html = 'HenÃ¼z console log bulunamadÄ±.';
            } else {
                consoleLogs.forEach(log => {
                    const typeColor = log.type === 'error' ? '#ef4444' : 
                                    log.type === 'warn' ? '#f59e0b' : '#10b981';
                    html += `<div style="color: ${typeColor};">[${log.time}] ${log.type.toUpperCase()}: ${log.args.join(' ')}</div>`;
                });
            }

            logsDiv.innerHTML = html;
        }

        // Modal functionality
        document.addEventListener('DOMContentLoaded', function() {
            const testDeleteButton = document.getElementById('test-delete-button');
            const testModal = document.getElementById('test-deletion-modal');
            const closeTestModal = document.getElementById('close-test-modal');
            const cancelTest = document.getElementById('cancel-test');
            const confirmTest = document.getElementById('confirm-test');
            const testConfirmation = document.getElementById('test-confirmation');
            const modalTestStatus = document.getElementById('modal-test-status');

            testDeleteButton.addEventListener('click', function() {
                testModal.style.display = 'flex';
                modalTestStatus.innerHTML = '<div class="success-section">âœ… Modal baÅŸarÄ±yla aÃ§Ä±ldÄ±!</div>';
            });

            closeTestModal.addEventListener('click', function() {
                testModal.style.display = 'none';
            });

            cancelTest.addEventListener('click', function() {
                testModal.style.display = 'none';
            });

            testConfirmation.addEventListener('change', function() {
                confirmTest.disabled = !this.checked;
            });

            confirmTest.addEventListener('click', function() {
                alert('âœ… Test baÅŸarÄ±lÄ±! Modal tam Ã§alÄ±ÅŸÄ±yor.');
                testModal.style.display = 'none';
                modalTestStatus.innerHTML = '<div class="success-section">âœ… Modal testi tamamlandÄ±!</div>';
            });

            // Auto test Firebase connection
            setTimeout(testFirebaseConnection, 1000);

            // Real Account Deletion Test
            const realDeleteAccountButton = document.getElementById('real-delete-account-button');
            const realDeletionModal = document.getElementById('real-account-deletion-modal');
            const closeRealDeletionModal = document.getElementById('close-real-deletion-modal');
            const realCancelDeletion = document.getElementById('real-cancel-deletion');
            const realConfirmDeletion = document.getElementById('real-confirm-deletion');
            const realDeletionConfirmation = document.getElementById('real-deletion-confirmation');
            const realDeleteAccountNow = document.getElementById('real-delete-account-now');
            const realEmailDeletionRequest = document.getElementById('real-email-deletion-request');
            const realDeletionStatus = document.getElementById('real-deletion-status');

            realDeleteAccountButton.addEventListener('click', function() {
                realDeletionModal.style.display = 'flex';
                realDeletionStatus.innerHTML = '<div class="success-section">âœ… GerÃ§ek modal baÅŸarÄ±yla aÃ§Ä±ldÄ±!</div>';
            });

            closeRealDeletionModal.addEventListener('click', function() {
                realDeletionModal.style.display = 'none';
            });

            realCancelDeletion.addEventListener('click', function() {
                realDeletionModal.style.display = 'none';
            });

            realDeletionConfirmation.addEventListener('change', function() {
                realConfirmDeletion.disabled = !this.checked;
                realDeleteAccountNow.disabled = !this.checked;
            });

            realDeleteAccountNow.addEventListener('click', function() {
                if (!realDeletionConfirmation.checked) {
                    alert('LÃ¼tfen onay kutucuÄŸunu iÅŸaretleyin.');
                    return;
                }

                if (confirm('SON UYARI: HesabÄ±nÄ±z kalÄ±cÄ± olarak silinecek. Bu iÅŸlem geri alÄ±namaz. Devam etmek istiyor musunuz?')) {
                    console.log('User confirmed account deletion');
                    
                    // Firebase kontrolÃ¼
                    if (typeof firebase === 'undefined') {
                        alert('Firebase yÃ¼klenemedi. LÃ¼tfen sayfayÄ± yenileyin.');
                        return;
                    }

                    const auth = firebase.auth();
                    if (!auth) {
                        alert('Firebase Auth yÃ¼klenemedi. LÃ¼tfen sayfayÄ± yenileyin.');
                        return;
                    }

                    // Mock user kullan
                    const user = window.mockUser || auth.currentUser;
                    if (!user) {
                        alert('Oturum bulunamadÄ±. Test iÃ§in Firebase Auth testini Ã§alÄ±ÅŸtÄ±rÄ±n.');
                        return;
                    }

                    console.log('Starting account deletion for user:', user.uid);

                    // Simulated deletion process
                    alert(`TEST: Hesap silme iÅŸlemi baÅŸlatÄ±ldÄ±!\n\nKullanÄ±cÄ±: ${user.email}\nUID: ${user.uid}\n\nGerÃ§ek uygulamada bu iÅŸlem tÃ¼m verileri siler.`);
                    realDeletionModal.style.display = 'none';
                    realDeletionStatus.innerHTML = '<div class="success-section">âœ… Hesap silme testi baÅŸarÄ±lÄ±!</div>';
                }
            });

            realEmailDeletionRequest.addEventListener('click', function() {
                const user = window.mockUser || (firebase.auth() ? firebase.auth().currentUser : null);
                const userEmail = user ? user.email : 'test@bilgoo.com';
                const userUid = user ? user.uid : 'test-user-123';

                const subject = encodeURIComponent('Hesap Silme Talebi - Bilgoo Quiz');
                const body = encodeURIComponent(
                    `Merhaba Bilgoo Ekibi,\n\n` +
                    `HesabÄ±mÄ±n kalÄ±cÄ± olarak silinmesini talep ediyorum.\n\n` +
                    `KullanÄ±cÄ± Bilgileri:\n` +
                    `- E-posta: ${userEmail}\n` +
                    `- User ID: ${userUid}\n` +
                    `- Tarih: ${new Date().toLocaleDateString('tr-TR')}\n\n` +
                    `LÃ¼tfen hesabÄ±mÄ± ve tÃ¼m verilerimi kalÄ±cÄ± olarak silin.\n\n` +
                    `TeÅŸekkÃ¼rler.`
                );

                const mailtoLink = `mailto:support@bilgoo.com?subject=${subject}&body=${body}`;
                window.location.href = mailtoLink;

                realDeletionModal.style.display = 'none';
                realDeletionStatus.innerHTML = '<div class="success-section">âœ… E-posta silme talebi gÃ¶nderildi!</div>';
            });
        });
    </script>
</body>
</html>
