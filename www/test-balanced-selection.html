<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dengeli Soru SeÃ§imi Testi</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #fafafa;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .success { background: #d4edda; border: 1px solid #c3e6cb; }
        .warning { background: #fff3cd; border: 1px solid #ffeaa7; }
        .info { background: #d1ecf1; border: 1px solid #bee5eb; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .question-type {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
        }
        .type-multiple { background: #e3f2fd; color: #1565c0; }
        .type-blank { background: #f3e5f5; color: #7b1fa2; }
        .type-truefalse { background: #e8f5e8; color: #2e7d32; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ Dengeli Soru SeÃ§imi Test Sistemi</h1>
        <p>Bu test, yeni dengeli soru seÃ§im algoritmasÄ±nÄ±n Ã§alÄ±ÅŸÄ±p Ã§alÄ±ÅŸmadÄ±ÄŸÄ±nÄ± kontrol eder.</p>
        
        <div class="test-section">
            <h3>Hedef DaÄŸÄ±lÄ±m (5 soru iÃ§in):</h3>
            <div class="result info">
                <strong>Ä°deal:</strong> 3 Ã‡oktan SeÃ§meli + 1 BoÅŸluk Doldurma + 1 DoÄŸru/YanlÄ±ÅŸ
            </div>
        </div>

        <div class="test-section">
            <h3>Test Kategorisi SeÃ§in:</h3>
            <button onclick="testCategory('Genel KÃ¼ltÃ¼r')">Genel KÃ¼ltÃ¼r</button>
            <button onclick="testCategory('Bilim')">Bilim</button>
            <button onclick="testCategory('Teknoloji')">Teknoloji</button>
            <button onclick="testCategory('Spor')">Spor</button>
            <button onclick="testCategory('Tarih')">Tarih</button>
            <button onclick="testCategory('CoÄŸrafya')">CoÄŸrafya</button>
            <button onclick="testCategory('MÃ¼zik')">MÃ¼zik</button>
            <button onclick="testCategory('Edebiyat')">Edebiyat</button>
        </div>

        <div id="results"></div>
    </div>

    <script src="script.js"></script>
    <script>
        let testResults = [];

        async function testCategory(category) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="result info">Test yapÄ±lÄ±yor...</div>';

            try {
                // QuizGame nesnesini kontrol et
                if (typeof QuizGame === 'undefined') {
                    throw new Error('QuizGame yÃ¼klenmedi');
                }

                // Soru verilerini yÃ¼kle
                if (!QuizGame.allQuestionsData) {
                    await QuizGame.loadQuestions();
                }

                if (!QuizGame.allQuestionsData[category]) {
                    throw new Error(`${category} kategorisi bulunamadÄ±`);
                }

                // Test iÃ§in sÄ±fÄ±rla
                QuizGame.clearSeenQuestions(category);

                // 5 farklÄ± test yap
                const tests = [];
                for (let i = 0; i < 5; i++) {
                    const questions = QuizGame.selectQuestionsWithNoRepeat(category, 5);
                    tests.push({
                        testNo: i + 1,
                        questions: questions,
                        distribution: getDistribution(questions)
                    });
                }

                displayResults(category, tests);

            } catch (error) {
                resultsDiv.innerHTML = `<div class="result warning">Hata: ${error.message}</div>`;
                console.error('Test hatasÄ±:', error);
            }
        }

        function getDistribution(questions) {
            const distribution = {
                'Ã‡okSeÃ§enekli': 0,
                'BlankFilling': 0,
                'DoÄŸruYanlÄ±ÅŸ': 0,
                'DiÄŸer': 0
            };

            questions.forEach(q => {
                const type = normalizeType(q.type || 'Ã‡okSeÃ§enekli');
                if (distribution[type] !== undefined) {
                    distribution[type]++;
                } else {
                    distribution['DiÄŸer']++;
                }
            });

            return distribution;
        }

        function normalizeType(type) {
            switch (type) {
                case 'Ã‡okSeÃ§enekli':
                case 'Ã‡oktan seÃ§meli':
                    return 'Ã‡okSeÃ§enekli';
                case 'BlankFilling':
                case 'BoÅŸluk doldurma':
                    return 'BlankFilling';
                case 'DoÄŸruYanlÄ±ÅŸ':
                    return 'DoÄŸruYanlÄ±ÅŸ';
                default:
                    return 'Ã‡okSeÃ§enekli';
            }
        }

        function displayResults(category, tests) {
            const resultsDiv = document.getElementById('results');
            
            let html = `<div class="test-section">
                <h3>ğŸ“Š ${category} Test SonuÃ§larÄ±</h3>`;

            tests.forEach((test, index) => {
                const { distribution } = test;
                const total = Object.values(distribution).reduce((a, b) => a + b, 0);
                
                // Ä°deal daÄŸÄ±lÄ±mla karÅŸÄ±laÅŸtÄ±r
                const ideal = { 'Ã‡okSeÃ§enekli': 3, 'BlankFilling': 1, 'DoÄŸruYanlÄ±ÅŸ': 1 };
                const isIdeal = distribution['Ã‡okSeÃ§enekli'] === 3 && 
                               distribution['BlankFilling'] === 1 && 
                               distribution['DoÄŸruYanlÄ±ÅŸ'] === 1;

                const resultClass = isIdeal ? 'success' : 'warning';

                html += `<div class="result ${resultClass}">
                    <strong>Test ${test.testNo}:</strong> 
                    <span class="question-type type-multiple">Ã‡oktan SeÃ§meli: ${distribution['Ã‡okSeÃ§enekli']}</span>
                    <span class="question-type type-blank">BoÅŸluk Doldurma: ${distribution['BlankFilling']}</span>
                    <span class="question-type type-truefalse">DoÄŸru/YanlÄ±ÅŸ: ${distribution['DoÄŸruYanlÄ±ÅŸ']}</span>
                    ${distribution['DiÄŸer'] > 0 ? `<span class="question-type">DiÄŸer: ${distribution['DiÄŸer']}</span>` : ''}
                    ${isIdeal ? ' âœ… Ä°deal!' : ' âš ï¸ Ä°deal deÄŸil'}
                    <br><small>Toplam: ${total} soru</small>
                </div>`;

                // Soru detaylarÄ±nÄ± gÃ¶ster
                html += '<div style="margin-left: 20px; font-size: 12px; color: #666;">';
                test.questions.forEach((q, qIndex) => {
                    const typeClass = getTypeClass(q.type);
                    html += `${qIndex + 1}. <span class="question-type ${typeClass}">${q.type || 'Ã‡okSeÃ§enekli'}</span> ${q.id}: ${q.question.substring(0, 50)}...<br>`;
                });
                html += '</div><br>';
            });

            // Genel deÄŸerlendirme
            const idealCount = tests.filter(test => {
                const d = test.distribution;
                return d['Ã‡okSeÃ§enekli'] === 3 && d['BlankFilling'] === 1 && d['DoÄŸruYanlÄ±ÅŸ'] === 1;
            }).length;

            const successRate = (idealCount / tests.length * 100).toFixed(1);
            const overallClass = successRate >= 80 ? 'success' : successRate >= 50 ? 'warning' : 'error';

            html += `<div class="result ${overallClass}">
                <strong>ğŸ“ˆ Genel BaÅŸarÄ± OranÄ±:</strong> ${idealCount}/${tests.length} test ideal daÄŸÄ±lÄ±m (%${successRate})
            </div>`;

            html += '</div>';
            resultsDiv.innerHTML = html;
        }

        function getTypeClass(type) {
            const normalized = normalizeType(type);
            switch (normalized) {
                case 'Ã‡okSeÃ§enekli': return 'type-multiple';
                case 'BlankFilling': return 'type-blank';
                case 'DoÄŸruYanlÄ±ÅŸ': return 'type-truefalse';
                default: return '';
            }
        }

        // Sayfa yÃ¼klendiÄŸinde
        window.onload = function() {
            console.log('Test sayfasÄ± yÃ¼klendi');
        };
    </script>
</body>
</html>
